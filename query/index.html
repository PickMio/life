<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link rel="stylesheet" href="lib/bootstrap.min.css">
<link href="lib/style.css" rel="stylesheet" type="text/css" />
<script src="lib/jquery.js" type="text/javascript"></script>
<script src="lib/bootstrap.min.js"></script> 
<meta charset="utf-8">
<meta HTTP-EQUIV="Cache-Control" CONTENT="no-cache, must-revalidate">
<title>乾罡项目考核报表</title>
</head>

<body style="background-image: url(lib/bg.png)">
<div class="mainframe">
<font color="white">

<table class="table table-condensed" >
    <h3 id="DateInfo"></h3>
    <div class="progress progressback" id="dateProcess">
        
    </div>
   <thead>
     <tr>
       <th width="12%">业绩表 <small id="workTotalCount"></small></th>
       <th width="80%" style="text-align: right" id="goodJudge"><span id="workBad"></span><span id="workNormal"></span><span id="workGood"></span><span id="workPerfect"></span></th>
       
     </tr>
   </thead>
   <tbody class='progressback' id="work_list">
         
   </tbody>
 </table>

<table class="table table-condensed" >
    <h3 id="DateInfo"></h3>        
   <thead>
     <tr>
       <th width="20%">项目表 <small id="projectTotalCount"></small></th>
     </tr>
   </thead>
   <tbody class='progressback' id="project_list">
         
   </tbody>
 </table>
<nav class="navbar navbar-inverse navbar-fixed-bottom">
 <div id='selectDate' style="align: bottom">
  <h5 class='floatThings'>选择年份:</h5>
    <select class="form-control" style="width: 10%;display:inline;" id="showYear"> 
         <option value=2016>2016</option><option value=2017>2017</option><option value=2018>2018</option><option value=2019>2019</option>
         <option value=2020>2020</option><option value=2021>2021</option><option value=2022>2022</option><option value=2023>2023</option>
         <option value=2024>2024</option><option value=2025>2025</option><option value=2026>2026</option><option value=2027>2027</option>
         <option value=2028>2028</option><option value=2029>2029</option><option value=2030>2030</option><option value=2031>2031</option>
         <option value=2032>2032</option><option value=2033>2033</option><option value=2034>2034</option><option value=2035>2035</option>
         <option value=2036>2036</option><option value=2037>2037</option><option value=2038>2038</option><option value=2039>2039</option>
    </select>
    <h5 class='floatThings'>选择月份:</h5>
    <select class="form-control" style="width: 10%;display:inline;" id="showMonth"> 
         <option value=1>1</option><option value=2>2</option><option value=3>3</option><option value=4>4</option>
         <option value=5>5</option><option value=6>6</option><option value=7>7</option><option value=8>8</option>
         <option value=9>9</option><option value=10>10</option><option value=11>11</option><option value=12>12</option>

    </select>
</div>
</nav>




</font>
</div>

<script type="text/javascript">


 <!-- 页眉显示的信息-->
      $(function () {
                $("#showMonth").bind("change", 

    function(){   
        
        var year = $("#showYear").val();
        var month = $("#showMonth").val();
        $.getJSON("http://localhost/query/query.php",{
                  protocol:12,
                  year: year,
                  month: month,
                  },
                  function(result){
                  if (!result.success) {$("#modelMsg").attr("class","alert alert-danger");$("#mymodal").modal("toggle");$("#modelMsg").html(result.msg);return;}
                  $count = result.msg['count'];
                  $timeShow = result.msg['timeShow'];
                  $("#DateInfo").html(year+"年" + month + "月:");
                  if("" == $timeShow){
                      $("#dateProcess").html('');$("#workBad").html('');
                      $("#workNormal").html('');$("#workGood").html('');$("#workPerfect").html('');
                      return;
                      }
                        $info = $timeShow.split('/');
                        $percent = $info[0]/$info[1] * 100;
                        $bad = $count - 15;
                        $normal = $count - 10;
                        $good = $count - 5;
                        $perfect = $count;
                      
                  var barHtml = "<div class='progress-bar progress-bar-success'  role='progressbar' aria-valuenow='11' aria-valuemin='0' aria-valuemax='100' style='width:" + $percent + "%'><span class='worksCount'>" + $timeShow + "</span></div>";
                    $("#dateProcess").html(barHtml);

                  
                  $("#workBad").html("<big>差</big><small id='workBadCount' class='currentTotal'>" + $bad + "</small>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;");
                  $("#workNormal").html("<big>中</big><small id='workNormalCount' class='currentTotal'>" + $normal + "</small>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;");
                  $("#workGood").html("<big>良</big><small id='workGoodCount' class='currentTotal'>" + $good+ "</small>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;");
                  $("#workPerfect").html("<big>优</big><small id='workPerfectCount' class='currentTotal'>" + $perfect + "</small>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;");
                  
                  });
                  


        $('#work_list').html('');        
        var goodCount = 0;
        $.getJSON("http://localhost/query/query.php",{
                          protocol:12,
                          year: year,
                          month: month,
                          },
                          function(result){
                          if (!result.success) {$("#modelMsg").attr("class","alert alert-danger");$("#mymodal").modal("toggle");$("#modelMsg").html(result.msg);return;}
                          goodCount = result.msg['count'];


                  $.getJSON("http://localhost/query/query.php",{
                            protocol:6,
                            year: year,
                            month: month,
                            },
                            function(result){
                            if (!result.success) {$("#modelMsg").attr("class","alert alert-danger");$("#mymodal").modal("toggle");$("#modelMsg").html(result.msg);return;}
                            var $total = 0;
                            $.each(result.msg, function(i, field){
                            var $cents = field['counts'] * 100/goodCount;
                            if($cents >= 100){$cents = 94;}
                            if($cents <= 3){$cents = 3;}
                            var $counts = field['counts'];
                            var $html = "<tr><td class='tablHeadColor'><span ";
                            if (i < 3) {$html += "class='mvpNumber'";}
                             
                             $html += ">"+ (i+1) + '.</span> ' + "<span class='staffname'>" + field['staff_name'] + "</span></td><td><div class='progress progressback' style='display: inline'><div class='progress-bar progress-bar-"

                            if ($counts >= goodCount) {
                                  $html += "warning";
                              }else if($counts >= goodCount - 5){
                                  $html += "info";
                              }else if($counts >= goodCount - 10){
                                  $html += "success";
                              }else{
                                  $html += "danger";
                              }



                              $html += " role='progressbar' aria-valuenow='11' aria-valuemin='0' aria-valuemax='100' style='width:" + $cents + "%'><span class='worksCount'>" + $counts + "</span></div></div>";
                              $total = $total + parseInt($counts);

                              $html += "<img style='float: right'src= 'lib/btn1.png'data-toggle='collapse' data-target='#detail" + i;
                              $html +="'></img><br /><div id='detail" + i;
                              $html +=   "' class='collapse'></div>";
                              $html += "</td></tr>";
                              $("#work_list").append($html);



                               $.getJSON("http://localhost/query/query.php",{
                                  protocol:7,
                                  staff_id: field["staff_id"],
                                  year: year,
                                  month: month,
                                  },
                                  function(result){
                                  if (!result.success) {$("#modelMsg").attr("class","alert alert-danger");$("#mymodal").modal("toggle");$("#modelMsg").html(result.msg);return;}
                                  var $user = "#detail" + i;
                                  $.each(result.msg, function(j, data){
                                      var $projectHtml = "<p><span class = 'projectname'>"+ data['project_name'] + ":</span> <span class='projectnumber'>" + data['project_count'] + "</span></p>";
                                      $($user).append($projectHtml);
                                                                     
                                      });
                                  });

                              });
                              $("#workTotalCount").html("<span class='currentTotal'>总计:" + $total +"</span>");
                            });
                          });



                  $("#project_list").html('');
                  $.getJSON("http://localhost/query/query.php",{
                  protocol:8,
                  year: year,
                  month: month,
                  },
                  function(result){
                  if (!result.success) {$("#modelMsg").attr("class","alert alert-danger");$("#mymodal").modal("toggle");$("#modelMsg").html(result.msg);return;}
                  var $total = 0;
                  $.each(result.msg, function(i, field){
                    var $cents = field['counts'] * 100/50;
                    if($cents >= 100){$cents = 100;}
                    var $counts = field['counts'];
                    var $html = "<tr><td class='tablHeadColor'>" + (i+1) + '. ' + field['project_name'] + "</td><td><div class='progress progressback' ><div class='progress-bar progress-bar-info' role='progressbar' aria-valuenow='11' aria-valuemin='0' aria-valuemax='100' style='width:" + $cents + "%'><span class='worksCount'>" + $counts + "</span></div></div></td></tr>";

                      $total = $total + parseInt($counts);
                      $("#project_list").append($html);                                       
                      });
                      $("#projectTotalCount").html("<span class='currentTotal'>总计:" + $total + "</span>");
                  });


                  });

        var myDate = new Date(); 
        var year = myDate.getFullYear();
        var month = myDate.getMonth()+1;
            $("#showMonth").val(month);
            $("#showYear").val(year);
            $("#showMonth").trigger ("change");
              });


   


   
</script>
</body>
</html>